{% extends "tasks/base.html" %}
{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî TaskManager{% endblock %}

{% block content %}
<nav class="navbar bg-white shadow-sm px-4 py-3 mb-4">
  <span class="navbar-brand">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ request.user.username }}</span>
  <div class="d-flex gap-2">
    <a href="{% url 'tasks' %}" class="btn btn-outline-primary btn-sm">–ó–∞–¥–∞—á–∏</a>
    <a href="{% url 'friends' %}" class="btn btn-outline-info btn-sm">–î—Ä—É–∑—å—è</a>
    <a href="{% url 'profile' %}" class="btn btn-outline-dark btn-sm">–ü—Ä–æ—Ñ–∏–ª—å</a>
  </div>
</nav>
<div class="container">
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="card-title">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</h6>
          <span class="display-5 fw-bold text-primary">{{ total_tasks }}</span>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="card-title">–ê–∫—Ç–∏–≤–Ω—ã–µ</h6>
          <span class="display-5 fw-bold text-success">{{ active_tasks }}</span>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="card-title">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</h6>
          <span class="display-5 fw-bold text-info">{{ completed_tasks }}</span>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="card-title">–ó–∞–∫—Ä—ã—Ç—ã–µ</h6>
          <span class="display-5 fw-bold text-secondary">{{ closed_tasks }}</span>
        </div>
      </div>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-md-6 mb-4 mb-md-0">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="card-title">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ –¥–∞—Ç–∞–º</h6>
          <canvas id="completedByDateChart" height="120"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="card-title">–ó–∞–¥–∞—á–∏ –ø–æ —Ç–∏–ø—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h6>
          <canvas id="reminderTypeChart" height="120"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="row mt-4">
    <div class="col-md-12">
      <div class="alert alert-warning text-center fs-5">
        –°—É–º–º–∞—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∑–∞ –≤—Å–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏: <b>{{ total_points }}</b> ‚≠ê
      </div>
    </div>
  </div>
</div>
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// –ì—Ä–∞—Ñ–∏–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –ø–æ –¥–∞—Ç–∞–º
const completedByDate = JSON.parse('{{ completed_by_date|safe|escapejs }}');
const dateLabels = completedByDate.map(item => item.due_date__date);
const dateCounts = completedByDate.map(item => item.count);
new Chart(document.getElementById('completedByDateChart'), {
  type: 'line',
  data: {
    labels: dateLabels,
    datasets: [{
      label: '–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏',
      data: dateCounts,
      borderColor: '#0d6efd',
      backgroundColor: 'rgba(13,110,253,0.1)',
      fill: true,
      tension: 0.3,
      pointRadius: 4,
      pointBackgroundColor: '#0d6efd',
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: false } },
    scales: { y: { beginAtZero: true } }
  }
});
// –ì—Ä–∞—Ñ–∏–∫ –ø–æ —Ç–∏–ø—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
const reminderMap = {
  'one_time': '–û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ',
  'periodic': '–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ',
  'daily': '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ',
  'trigger': '–ü–æ —Ç—Ä–∏–≥–≥–µ—Ä—É',
};
const byReminder = JSON.parse('{{ by_reminder|safe|escapejs }}');
const reminderLabels = byReminder.map(item => reminderMap[item.reminder_type] || item.reminder_type);
const reminderCounts = byReminder.map(item => item.count);
new Chart(document.getElementById('reminderTypeChart'), {
  type: 'doughnut',
  data: {
    labels: reminderLabels,
    datasets: [{
      data: reminderCounts,
      backgroundColor: ['#0d6efd', '#20c997', '#ffc107', '#6f42c1'],
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: 'bottom' } }
  }
});
</script>
{% endblock %} 