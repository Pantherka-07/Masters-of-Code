{% extends "tasks/base.html" %}
{% block title %}–ó–∞–¥–∞—á–∏ ‚Äî TaskManager{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="mb-3 text-end">
    <span class="badge bg-success fs-5">–°—É–º–º–∞—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞: {{ total_points }} ‚≠ê</span>
  </div>
  <ul class="nav nav-tabs">
    <li class="nav-item"><a class="nav-link {% if status == 'active' %}active{% endif %}" href="?status=active">–ê–∫—Ç–∏–≤–Ω—ã–µ</a></li>
    <li class="nav-item"><a class="nav-link {% if status == 'completed' %}active{% endif %}" href="?status=completed">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</a></li>
    <li class="nav-item"><a class="nav-link {% if status == 'closed' %}active{% endif %}" href="?status=closed">–ó–∞–∫—Ä—ã—Ç—ã–µ</a></li>
  </ul>
  <div class="mt-4">
    {% if tasks %}
      {% for task in tasks %}
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title">üìå {{ task.title }}</h5>
            <p class="card-text mb-1">üóìÔ∏è {{ task.due_date|date:'Y-m-d H:i' }} | üîÅ {{ task.get_reminder_type_display }} | üìß {{ task.get_notification_method_display }}</p>
            {% if task.description %}
              <p class="card-text mb-1">üìù {{ task.description }}</p>
            {% endif %}
            {% if task.points %}
              <p class="card-text mb-1">‚≠ê –û—á–∫–∏: {{ task.points }}</p>
            {% endif %}
            {% if task.trigger_task %}
              <p class="card-text mb-1">üîó –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ: {{ task.trigger_task.title }}</p>
            {% endif %}
            <div class="d-flex gap-2">
              {% if not task.is_completed %}
                <form method="post" action="{% url 'task_complete' task.pk %}?status={{ status }}">{% csrf_token %}<button class="btn btn-outline-success btn-sm">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button></form>
              {% endif %}
              {% if not task.is_closed %}
                <form method="post" action="{% url 'task_close' task.pk %}?status={{ status }}">{% csrf_token %}<button class="btn btn-outline-secondary btn-sm">–ó–∞–∫—Ä—ã—Ç—å</button></form>
              {% endif %}
              <a href="{% url 'task_update' task.pk %}" class="btn btn-outline-primary btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
              <form method="post" action="{% url 'task_delete' task.pk %}?status={{ status }}" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?');" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-outline-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–¥–∞—á.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
